{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Payment History</h2>
    
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Service Type</th>
                            <th>Amount</th>
                            <th>Payment Method</th>
                            <th>Status</th>
                            <th>Transaction ID</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsList">
                        <!-- Payments will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadPayments();
});

function loadPayments() {
    fetch('/payment/payments')
        .then(response => response.json())
        .then(payments => {
            const paymentsList = document.getElementById('paymentsList');
            paymentsList.innerHTML = '';
            
            payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(payment.created_at).toLocaleString()}</td>
                    <td>${formatServiceType(payment.service_type)}</td>
                    <td>$${payment.amount.toFixed(2)}</td>
                    <td>${formatPaymentMethod(payment.payment_method)}</td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(payment.status)}">
                            ${formatStatus(payment.status)}
                        </span>
                    </td>
                    <td>${payment.transaction_id || 'N/A'}</td>
                    <td>${payment.description || 'N/A'}</td>
                `;
                paymentsList.appendChild(row);
            });
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to load payment history');
        });
}

function formatServiceType(type) {
    const types = {
        'thesis_sharing': 'Thesis Sharing',
        'gpa_record': 'GPA Record',
        'student_identity': 'Student Identity'
    };
    return types[type] || type;
}

function formatPaymentMethod(method) {
    const methods = {
        'transfer': 'Bank Transfer',
        'paypal': 'PayPal',
        'wechat': 'WeChat Pay',
        'alipay': 'Alipay',
        'credit_card': 'Credit Card'
    };
    return methods[method] || method;
}

function formatStatus(status) {
    const statuses = {
        'pending': 'Pending',
        'completed': 'Completed',
        'failed': 'Failed',
        'cancelled': 'Cancelled'
    };
    return statuses[status] || status;
}

function getStatusBadgeClass(status) {
    const classes = {
        'pending': 'bg-warning',
        'completed': 'bg-success',
        'failed': 'bg-danger',
        'cancelled': 'bg-secondary'
    };
    return classes[status] || 'bg-primary';
}
</script>
{% endblock %} 