{% extends 'basic.html' %}
{% block title %}Register as OConvener{% endblock %}
{% block content %}
<h2>Register as OConvener</h2>

<form method="post" action="{{ url_for('auth.register') }}">
    <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" name="email" id="email" required>
    </div>

    <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" name="username" id="username" required>
    </div>

    <div class="form-group">
        <label for="bank_account">Bank Account:</label>
        <input type="text" name="bank_account" id="bank_account" required>
    </div>

    <button type="button" onclick="requestOTP()">Get Verification Code</button>

    <div class="form-group">
        <label for="otp">Verification code:</label>
        <input type="text" name="otp" id="otp" required maxlength="6" minlength="6">
    </div>

    <button type="submit">Register</button>
</form>

<p id="message" style="color: red;"></p>

<script>
function requestOTP() {
    const email = document.getElementById('email').value;
    const messageElem = document.getElementById('message');

    if (!email) {
        messageElem.textContent = 'Please enter your email';
        return;
    }

    fetch('{{ url_for("auth.api_request_otp") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token() if csrf_token }}'
        },
        body: JSON.stringify({ email: email })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messageElem.style.color = 'green';
            messageElem.textContent = 'Verification code sent. Please check your Email.';
        } else {
            messageElem.style.color = 'red';
            messageElem.textContent = data.message || 'Failed sending verification code.';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        messageElem.textContent = 'An error occurred. Please try again later.';
    });
}
</script>

<style>
.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
}

.form-group input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

button {
    padding: 10px 15px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin: 5px 0;
}

button:hover {
    background-color: #0056b3;
}
</style>
{% endblock %}
